---
layout: post
title: 线程、进程、死锁、进程通信
categories: Java
description: 线程、进程、死锁等整理
keywords: 线程、进程、死锁、进程通信
tags: 线程、进程、死锁、进程通信

---

### 线程和进程的区别

> 进程：程序的一个运行实例

1. 进程是一个具有独立功能的程序关于某个数据集合的一次运行活动。
2. 它可以申请和拥有系统资源，是一个动态的概念，是一个活动的实体。
3. 它不只是程序的代码，还包括当前的活动，通过程序计数器的值和处理寄存器的内容来表示。

> 线程：CPU调度的基本单元

1. 线程是程序执行流的最小单元
2. 线程是进程中的一个实体，是被系统独立调度和分派的基本单位
3. 线程自己不拥有系统资源，只拥有一点儿在运行中必不可少的资源，但它可与同属一个进程的其它线程共享进程所拥有的全部资源。
4. 线程也有就绪、阻塞和运行三种基本状态。
5. 就绪状态是指线程具备运行的所有条件，逻辑上可以运行，在等待处理机；
6. 运行状态是指线程占有处理机正在运行；
7. 阻塞状态是指线程在等待一个事件（如某个信号量），逻辑上不可执行。每一个程序都至少有一个线程，若程序只有一个线程，那就是程序本身。

> 区别

1. 地址空间和其它资源：进程间相互独立，同一进程的各线程间共享。某进程内的线程在其它进程不可见。
2. 通信：进程间通信IPC，线程间可以直接读写进程数据段（如全局变量）来进行通信——需要进程同步和互斥手段的辅助，以保证数据的一致性。
3. 调度和切换：线程上下文切换比进程上下文切换要快得多。
4. 在多线程OS中，进程不是一个可执行的实体。

### 线程切换及性能影响

#### 线程的生命周期5状态

1. 新建（new）：新创建一个线程。
2. 可运行（runnable）：线程对象创建后，其他线程调用了该对象的start()方法，线程处于可运行的线程池中，等待被线程调度选中获取cpu使用权。
3. 运行（running）：可运行状态的线程获取了cpu时间片，执行程序代码。
4. 阻塞（block）：线程因为某种原因放弃了cpu的使用权，暂时进入停止状态。 直到线程进入可执行状态才能再次获得cpu时间片转到运行状态。
	阻塞状态分三种情况：
	1. 等待阻塞：运行中的线程执行了wait方法，进入等待队列。
	2. 同步阻塞：运行中的线程获取同步锁的时候该同步锁被其他线程占用，线程被jvm放入锁池中。
	3. 其他阻塞：运行中的线程执行了Thread.sleep或者t.join方法，或者线程发出了I/0请求。当sleep状态超时，join等待线程终止或超时，I/O处理完毕时，线程重新进入可运行状态。
5. 死亡（dead）：线程run()方法、main()方法执行结束，或者因异常退出了run（）方法，该线程结束生命周期。死亡的线程不能再次复生。


### 线程之间如何进行同步



### 死锁如何造成的，如何避免
### 进程间通信方式

1. 共享内存（Shared Memory）：两个进程直接共享访问同一块内存区域
    1. 创建内存共享区：进程A创建内存共享区，生成的共享区与某个key绑定。
    2. 映射内存共享区：把内存共享区映射到进程A的空间
    3. 访问内存共享区：进程B通过key将内存映射到空间
    4. 进程间通信：两个进程通过共享区内存进行通信
    5. 撤销内存共享区：各个进程撤销内存共享区
    6. 删除内存共享区：删除内存共享区并回收内存
2. 管道 （Pipe）
    1. 两个进程分立两边进行通信
    2. 管道是单向的，既要读又要写的话需要两个管道
    3. 一根管道同时具有读取端和写入端
    4. 管道的容量有限，当pipe满时写操作将阻塞，当pipe里空时读操作将阻塞
3. Unix Domain Socket（Android使用最多的是Binder其次就是UDS）
    1. 服务器端监听IPC请求
    2. 客户端发起IPC申请
    3. 双方成功建立IPC连接
    4. 客户端向服务端发送信息证明IPC通信是有效的
    ![thread_UDS](/assets/images/thread_UDS.png)

4. RPC（Remote Procedure Calls）
    1. 客户端进程调用Stub接口
    2. Stub根据操作系统的要求进行打包，并进行相应的系统调用
    3. 由内核来完成与服务端的具体交互，它负责将客户端的数据包发送给服务端的内核
    4. 进程执行操作
    5. 服务器以上操作的逆向过程将结果返回给客户端
    ![thread_RP](/assets/images/thread_RPC.png)


### 进程同步

1. 信号量（Semaphore）
2. 互斥体 Mutex（Mutual Exclusion）
3. 管程（Monitor）


